function getConnection() {
	const current_url = window.location.href;
	const url_object = new URL(current_url);
  
	const protocol = url_object.protocol;
	const domain = url_object.hostname;
	const port = url_object.port;
  
	return `${protocol}//${domain}:${port}`;
}

const hostname = getConnection();
console.log("Hostname: ", hostname);

const login = document.getElementById("login");
const email = document.getElementById("email");
const remember = document.getElementById("rememberme");
const cookieLogin = "cookieLogin";

const requiredFields = ["username", "password"];

(function(){
    // check if there is a parameter called email in the url, if so, set the email field to that value
    const urlParams = new URLSearchParams(window.location.search);
    const emailtemp = urlParams.get('email');
    if (emailtemp) {
        email.value = emailtemp;
    }
    
    if(getCookie(cookieLogin) !== ""){
        email.value = getCookie(cookieLogin);
        remember.checked = true;
    }
})();

login.addEventListener("click", function(){

    let data = {}

    storeEmailOrTriggerError("email", data, "username");
    storeTextOrTriggerError("password", data, "password", 6, 20);

    if(isKeysInDict(data, requiredFields)){
        alrtMessage.innerHTML = "Successfully filled out.";
        swapAlert("alert-success", "alert-warning");

        if (remember.checked) {
            setCookie(cookieLogin, data["username"], 1);
        }

        sendRequest("POST", hostname + "/login", data)
        .then(function(response){
            console.log(response);
            if(response.message == "success"){
                alrtMessage.innerHTML = "Logged in successfully.";
                swapAlert("alert-success", "alert-warning");
            }
            else{
                alrtMessage.innerHTML = "Failed to log in.";
                swapAlert("alert-warning", "alert-success");
            }
        }).catch(() => {
            alrtMessage.innerHTML = "Server is not responding or you don't have any conection.";
            swapAlert("alert-warning", "alert-success");
        })


    } else {
        alrtMessage.innerHTML = "Please fill in all the required fields.";
        swapAlert("alert-warning", "alert-success");
    }

})

remember.addEventListener("click", function(){
    if(remember.checked){
        setCookie(cookieLogin, email.value, 1);
    } else {
        deleteCookie(cookieLogin);
    }
})
